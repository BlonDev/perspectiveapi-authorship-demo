!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("d3-interpolate"),require("toxiclibsjs"),require("gsap"),require("twemoji"),require("@angular/http"),require("rxjs"),require("rxjs/operators"),require("@angular/platform-browser/animations"),require("@angular/platform-browser"),require("@angular/common"),require("@angular/forms"),require("@angular/material"),require("@angular/material/form-field"),require("@angular/material/select")):"function"==typeof define&&define.amd?define("@conversationai/perspectiveapi-authorship-demo",["exports","@angular/core","d3-interpolate","toxiclibsjs","gsap","twemoji","@angular/http","rxjs","rxjs/operators","@angular/platform-browser/animations","@angular/platform-browser","@angular/common","@angular/forms","@angular/material","@angular/material/form-field","@angular/material/select"],t):t((e.conversationai=e.conversationai||{},e.conversationai["perspectiveapi-authorship-demo"]={}),e.ng.core,e.d3,e.toxicLibsJS,e.gsap,e.twemoji,e.ng.http,e.rxjs,e.Rx.Observable.prototype,e.ng.platformBrowser.animations,e.ng.platformBrowser,e.ng.common,e.ng.forms,e.ng.material,e.ng.material["form-field"],e.ng.material.select)}(this,function(e,n,i,o,s,t,l,c,g,a,r,d,u,h,m,p){"use strict";function f(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}t=t&&t.hasOwnProperty("default")?t["default"]:t;var y={CIRCLE:0,SQUARE:1,DIAMOND:2};y[y.CIRCLE]="CIRCLE",y[y.SQUARE]="SQUARE",y[y.DIAMOND]="DIAMOND";var S={SMILE:0,NEUTRAL:1,SAD:2};S[S.SMILE]="SMILE",S[S.NEUTRAL]="NEUTRAL",S[S.SAD]="SAD";var b={DEMO_SITE:0,EXTERNAL:1};b[b.DEMO_SITE]="DEMO_SITE",b[b.EXTERNAL]="EXTERNAL";var C={DEMO_SITE:"default",EXTERNAL:"external"},A={OKAY:0,BORDERLINE:.2,UNCIVIL:.76,MAX:1},E={CIRCLE_SQUARE_DIAMOND:"circle_square_diamond",EMOJI:"emoji"},I='likely to be perceived as "toxic."',x="fadeStart",v=.5,L="emojiMainLoadingAnimation",k="#cccccc",T="#ffcc4d",w=function(){function e(e,t){this.ngZone=e,this.elementRef=t,this.indicatorWidth=13,this.indicatorHeight=13,this.configurationInput=C.DEMO_SITE,this.hasScore=!1,this.fontSize=12,this.gradientColors=["#ffffff","#000000"],this.canAcceptFeedback=!1,this.feedbackRequestInProgress=!1,this.feedbackRequestSubmitted=!1,this.feedbackRequestError=!1,this.feedbackText=[I,I,I],this.scoreThresholds=[A.OKAY,A.BORDERLINE,A.UNCIVIL],this.showPercentage=!0,this.showMoreInfoLink=!0,this.analyzeErrorMessage=null,this.scoreChangeAnimationCompleted=new n.EventEmitter,this.modelInfoLinkClicked=new n.EventEmitter,this.commentFeedbackSubmitted=new n.EventEmitter,this.configurationEnum=b,this.configuration=this.configurationEnum.DEMO_SITE,this.loadingIconStyleConst=E,this.score=0,this.currentLayerIndex=0,this.layerAnimationHandles=[],this.layerAnimationSelectors=["#layer1","#layer2","#layer3"],this.showFeedbackQuestion=!1,this.isLoading=!1,this.isPlayingLoadingAnimation=!1,this.isPlayingFadeDetailsAnimation=!1,this.isPlayingShowOrHideLoadingWidgetAnimation=!1,this.shouldHideStatusWidget=!1,this.showScore=!0,this.currentShape=y.CIRCLE,this.currentEmoji=S.SMILE,this.showingMoreInfo=!1,this.widgetElement=null,this.layersAnimating=!1,this.hideEmojiIconsForLoadingAnimation=!1,this.loadingIconStyleChanged=!1,this.scoreThresholdsChanged=!1,this.hideLoadingIconAfterLoadChanged=!1,this.alwaysHideLoadingIconChanged=!1,this.stateChangeAnimations=null,this.isPlayingStateChangeAnimations=!1,this.pendingPostLoadingStateChangeAnimations=null,this.isPlayingPostLoadingStateChangeAnimations=!1,this.currentStateChangeAnimationId=0}return e.prototype.ngOnInit=function(){this.configuration=this.getConfigurationFromInputString(this.configurationInput);try{for(var e=f(this.layerAnimationSelectors),t=e.next();!t.done;t=e.next()){var n=t.value;this.layerAnimationHandles.push(this.elementRef.nativeElement.querySelector(n))}}catch(a){i={error:a}}finally{try{t&&!t.done&&(o=e["return"])&&o.call(e)}finally{if(i)throw i.error}}var i,o;this.updateLayerElementContainers(),this.updateGradient()},e.prototype.ngAfterViewInit=function(){var e=this;this.widgetReady=Promise.resolve().then(function(){e.updateWidgetElement(),e.getUpdateWidgetStateAnimation().play()})},e.prototype.ngOnChanges=function(e){if(null!==this.widgetElement&&this.container!==undefined&&this.layerTextContainer!==undefined&&this.interactiveLayerControlsContainer!==undefined){if(e.loadingIconStyle!==undefined&&(console.debug("Loading icon style change:",e.loadingIconStyle),this.loadingIconStyleChanged=!0),e.gradientColors!==undefined&&(console.debug("Change in gradientColors"),this.updateGradient(),this.loadingIconStyle===E.CIRCLE_SQUARE_DIAMOND&&this.getUpdateGradientColorAnimation(.1).play()),e.configurationInput!==undefined&&(this.configuration=this.getConfigurationFromInputString(this.configurationInput),this.resetLayers()),e.scoreThresholds!==undefined){console.debug("Change in scoreThresholds");for(var t=!1,n=e.scoreThresholds,i=0;i<n.previousValue.length;i++)if(n.currentValue[i]!==n.previousValue[i]){t=!0;break}t&&(this.updateGradient(),this.updateDemoSettingsAnimation&&this.updateDemoSettingsAnimation.kill(),this.scoreThresholdsChanged=!0)}e.hideLoadingIconAfterLoad&&(this.hideLoadingIconAfterLoadChanged=!0),e.alwaysHideLoadingIcon&&(this.alwaysHideLoadingIconChanged=!0)}},e.prototype.ngAfterViewChecked=function(){var t=this;if(this.scoreThresholdsChanged||this.loadingIconStyleChanged||this.hideLoadingIconAfterLoadChanged||this.alwaysHideLoadingIconChanged){this.isPlayingStateChangeAnimations?(this.stateChangeAnimations.kill(),console.debug("Killing pending state change animation.")):this.isPlayingPostLoadingStateChangeAnimations&&(this.pendingPostLoadingStateChangeAnimations.kill(),this.isPlayingPostLoadingStateChangeAnimations=!1,console.debug("Killing pending post-loading state change animation"));var n=new s.TimelineMax({onStart:function(){t.ngZone.run(function(){t.isPlayingStateChangeAnimations=!0,console.debug("Starting state change animation")})},onComplete:function(){t.ngZone.run(function(){t.isPlayingStateChangeAnimations=!1,console.debug("Completing state change animation")})}});this.isLoading?this.pendingPostLoadingStateChangeAnimations=new s.TimelineMax({onStart:function(){t.ngZone.run(function(){t.isPlayingPostLoadingStateChangeAnimations=!0,console.debug("Started postLoadingStateChangeAnimations")})},onComplete:function(){t.ngZone.run(function(){t.isPlayingPostLoadingStateChangeAnimations=!1,console.debug("Completing postLoadingStateChangeAnimations")})}}):this.pendingPostLoadingStateChangeAnimations=null,Promise.resolve().then(function(){if((t.hideLoadingIconAfterLoadChanged||t.alwaysHideLoadingIconChanged)&&(t.hideLoadingIconAfterLoadChanged&&(console.debug("Setting hideLoadingIconAfterLoadChanged to false"),t.hideLoadingIconAfterLoadChanged=!1),t.alwaysHideLoadingIconChanged&&(console.debug("Setting alwaysHideLoadingIconChanged to false"),t.alwaysHideLoadingIconChanged=!1),t.loadingIconStyleChanged||(t.isLoading?t.pendingPostLoadingStateChangeAnimations.add(t.getUpdateWidgetStateAnimation()):n.add(t.getUpdateWidgetStateAnimation()))),t.loadingIconStyleChanged){t.updateWidgetElement(),t.shouldHideStatusWidget&&(t.widgetElement.style.transform="matrix(1,0,0,1,"+-1*(t.indicatorWidth+4+10)+",0)"),console.debug("Setting loadingIconStyleChanged to false"),t.loadingIconStyleChanged=!1;var e=new s.TimelineMax({});e.add(t.getUpdateWidgetStateAnimation()),t.isLoading?t.pendingPostLoadingStateChangeAnimations.add(e):n.add(e)}else t.scoreThresholdsChanged&&(console.debug("Setting scoreThresholdsChanged to false"),t.scoreThresholdsChanged=!1,t.updateDemoSettingsAnimation=t.getUpdateWidgetStateAnimation(),t.isLoading?t.pendingPostLoadingStateChangeAnimations.add(t.updateDemoSettingsAnimation):n.add(t.updateDemoSettingsAnimation));t.stateChangeAnimations=n,t.stateChangeAnimations.play()})}},e.prototype.getFirstGradientRatio=function(){return.9},e.prototype.getAdjustedGradientControlPoints=function(e){for(var t=[Math.floor(e*(this.scoreThresholds[0]+.9*(this.scoreThresholds[1]-this.scoreThresholds[0]))),Math.floor(e*this.scoreThresholds[1]),Math.floor(e*this.scoreThresholds[2])],n=t.length-1;0<=n;n--)t[n]>=t[n+1]&&(t[n]-=t[n]-t[n+1]+1);return t},e.prototype.updateGradient=function(){for(var e=this.getAdjustedGradientControlPoints(100),t=new o.color.ColorGradient,n=0;n<e.length;n++)0<=e[n]&&t.addColorAt(e[n],o.color.TColor.newHex(this.gradientColors[n]));this.gradientColorScale=t.calcGradient(0,100).colors.map(function(e){return e.toRGBCSS()})},e.prototype.interpolateColors=function(e){var t=Math.min(Math.floor(100*e),this.gradientColorScale.length-1),n=Math.min(Math.ceil(100*e),this.gradientColorScale.length-1);return i.interpolateRgb(this.gradientColorScale[t],this.gradientColorScale[n])(100*e-t)},e.prototype.updateWidgetElement=function(){null!=this.circleSquareDiamondWidget?this.widgetElement=this.circleSquareDiamondWidget.nativeElement:null!=this.emojiWidget?this.widgetElement=this.emojiWidget.nativeElement:(console.error("Widget element is null."),this.widgetElement=null)},e.prototype.getShouldHideStatusWidget=function(e){var t=!1;return this.hideLoadingIconAfterLoad&&(t=t||!e),this.hideLoadingIconForScoresBelowMinThreshold&&(t=t||e||this.score<this.scoreThresholds[0]),this.alwaysHideLoadingIcon&&(t=!0),t},e.prototype.getUpdateStatusWidgetVisibilityAnimation=function(e){var t=this,n=this.getShouldHideStatusWidget(e),i=!1;if(this.isPlayingShowOrHideLoadingWidgetAnimation&&(console.debug("Calling getUpdateStatusWidgetVisibility while isPlayingShowOrHideLoadingWidgetAnimation = true. "),i=!0),n===this.shouldHideStatusWidget&&!i)return console.debug("Returning without update status widget visibility animation."),new s.TimelineMax({});console.debug("Getting update status widget visibility animation."),this.isPlayingShowOrHideLoadingWidgetAnimation=!0;var o=new s.TimelineMax({onStart:function(){t.ngZone.run(function(){console.debug("Updating status widget visibility to "+(n?"hidden":"visible")+" from "+(t.shouldHideStatusWidget?"hidden":"visible")),t.shouldHideStatusWidget=!1})},onComplete:function(){t.ngZone.run(function(){console.debug("Changing status widget visibility complete, hide=",n),t.isPlayingShowOrHideLoadingWidgetAnimation=!1,t.shouldHideStatusWidget=n})}});return o.add([this.getChangeLoadingIconVisibilityAnimation(n),this.getChangeLoadingIconXValueAnimation(n)]),o},e.prototype.getChangeLoadingIconVisibilityAnimation=function(e){return s.TweenMax.to(this.widgetElement,.4,{opacity:e?0:1})},e.prototype.getSetIconToNeutralStateAnimation=function(){var e=new s.TimelineMax({});return this.loadingIconStyle===E.CIRCLE_SQUARE_DIAMOND?(e.add(this.getFadeAndShrinkAnimation(.3,!1)),e.add(this.getTransitionToCircleAnimation(1,k))):this.loadingIconStyle===E.EMOJI&&(e.add(this.getHideEmojisAnimation()),e.add(this.getChangeColorAnimation(.2,k))),e},e.prototype.getChangeLoadingIconXValueAnimation=function(e){var t=new s.TimelineMax({}),n=[];if(n.push(s.TweenMax.to(this.widgetElement,.4,{x:e?-1*(this.indicatorWidth+4+10):0})),this.configuration===b.DEMO_SITE){var i=this.elementRef.nativeElement.querySelector(this.layerAnimationSelectors[0]+" .layerText"),o=this.elementRef.nativeElement.querySelector(this.layerAnimationSelectors[1]+" .layerText"),a=this.elementRef.nativeElement.querySelector(this.layerAnimationSelectors[2]+" .interactiveElement"),r={x:e?-1*(this.indicatorWidth+4+10):0};n.push(s.TweenMax.to(i,.4,r)),n.push(s.TweenMax.to(o,.4,r)),n.push(s.TweenMax.to(a,.4,r))}return t.add(n),t},e.prototype.getConfigurationFromInputString=function(e){return e===C.EXTERNAL?b.EXTERNAL:b.DEMO_SITE},e.prototype.updateLayerElementContainers=function(){this.layerTextContainer=this.elementRef.nativeElement.querySelector(this.layerAnimationSelectors[this.currentLayerIndex]+" .layerText"),this.interactiveLayerControlsContainer=this.elementRef.nativeElement.querySelector(this.layerAnimationSelectors[this.currentLayerIndex]+" .interactiveElement")},e.prototype.shouldShowFeedback=function(e){return e>=this.scoreThresholds[0]},e.prototype.parseEmojis=function(e){return t.parse(e)},e.prototype.getFeedbackTextForScore=function(e){return e>=this.scoreThresholds[2]?this.feedbackText[2]:e>=this.scoreThresholds[1]?this.feedbackText[1]:e>=this.scoreThresholds[0]?this.feedbackText[0]:""},e.prototype.feedbackContainerClicked=function(){this.configuration===b.DEMO_SITE?this.getTransitionToLayerAnimation(1,v).play():this.configuration===b.EXTERNAL&&(this.showFeedbackQuestion=!0)},e.prototype.feedbackCompleted=function(e){if(e?this.feedbackRequestSubmitted=!0:this.feedbackRequestError=!0,this.configuration===b.DEMO_SITE){var t=new s.TimelineMax({});t.add([this.getTransitionToLayerAnimation(2,v),this.getSetIconToNeutralStateAnimation()]),t.play()}},e.prototype.hideFeedbackQuestion=function(){this.showFeedbackQuestion=!1},e.prototype.resetFeedback=function(){this.showFeedbackQuestion=!1,this.feedbackRequestInProgress=!1,this.feedbackRequestSubmitted=!1,this.feedbackRequestError=!1},e.prototype.resetLayers=function(){this.resetFeedback();var e=new s.TimelineMax({});e.add(this.getTransitionToLayerAnimation(0,v)),e.add(this.getUpdateWidgetStateAnimation()),e.play()},e.prototype.submitFeedback=function(e){this.feedbackRequestError=!1,this.commentFeedbackSubmitted.emit({commentMarkedAsToxic:e})},e.prototype.getResetRotationAnimation=function(){return s.TweenMax.to(this.widgetElement,.1,{rotation:this.currentShape===y.DIAMOND?45:0})},e.prototype.getShapeForScore=function(e){return e>this.scoreThresholds[2]?y.DIAMOND:e>this.scoreThresholds[1]?y.SQUARE:y.CIRCLE},e.prototype.getEmojiForScore=function(e){return e>this.scoreThresholds[2]?S.SAD:e>this.scoreThresholds[1]?S.NEUTRAL:S.SMILE},e.prototype.getUpdateShapeAnimation=function(e){var t=this;if(this.loadingIconStyle!==E.CIRCLE_SQUARE_DIAMOND)return console.debug("Calling getUpdateShapeAnimation(), but the loading iconstyle is not set to circle/square/diamond. Returning anempty timeline."),new s.TimelineMax({});var n=new s.TimelineMax({onStart:function(){t.isPlayingUpdateShapeAnimation=!0},onComplete:function(){t.isPlayingUpdateShapeAnimation=!1}});return n.add(this.getFadeAndShrinkAnimation(.3,!1)),e>this.scoreThresholds[2]?n.add(this.getTransitionToDiamondAnimation(.8)):e>this.scoreThresholds[1]?(this.isPlayingUpdateShapeAnimation&&(console.debug("Starting updateShapeAnimation to square while in the middle of an existing updateShapeAnimation or before the previous animation was able to finish; resetting rotation state"),n.add(this.getResetRotationAnimation())),n.add(this.getTransitionToSquareAnimation(1))):n.add(this.getTransitionToCircleAnimation(1)),n},e.prototype.setShowMoreInfo=function(e){this.getTransitionToLayerAnimation(e?1:0,v).play()},e.prototype.getAccessibilityDescriptionForEmoji=function(e){return e===S.SMILE?"Smile emoji":e===S.NEUTRAL?"Neutral emoji":"Sad emoji"},e.prototype.getEmojiElementFromEmojiType=function(e){return e===S.SMILE?this.smileEmoji.nativeElement:e===S.NEUTRAL?this.neutralEmoji.nativeElement:this.sadEmoji.nativeElement},e.prototype.getAnimationA11yLabel=function(e,t){return t?"Computing score animation":e===E.EMOJI?this.getAccessibilityDescriptionForEmoji(this.currentEmoji):this.getAccessibilityDescriptionForShape(this.currentShape)},e.prototype.notifyModelInfoLinkClicked=function(){this.modelInfoLinkClicked.emit()},e.prototype.getUpdateWidgetStateAnimation=function(){var e=this,t=new s.TimelineMax({onStart:function(){e.ngZone.run(function(){console.debug("Starting animation for getUpdateWidgetStateAnimation")})},onComplete:function(){e.ngZone.run(function(){console.debug("Completing animation for getUpdateWidgetStateAnimation"),e.scoreChangeAnimationCompleted.emit()})}});if(this.loadingIconStyle===E.CIRCLE_SQUARE_DIAMOND){console.debug("Update widget state for default style");var n=new s.TimelineMax({onComplete:function(){e.ngZone.run(function(){console.debug(e.scoreChangeAnimationCompleted),e.scoreChangeAnimationCompleted.emit()})}});return n.add(this.getUpdateStatusWidgetVisibilityAnimation(!1)),n.add(this.getUpdateShapeAnimation(this.score)),n}return this.loadingIconStyle===E.EMOJI?(console.debug("Update widget state for emoji style"),t.add(this.getUpdateStatusWidgetVisibilityAnimation(!1)),t.add(this.getShowEmojiAnimation()),t):(console.error("Calling updateWidgetState for unknown loadingIconStyle: "+this.loadingIconStyle),new s.TimelineMax({}))},e.prototype.notifyScoreChange=function(e){console.debug("Setting this.score =",e),this.score=e,this.isPlayingLoadingAnimation?this.setLoading(!1):(console.debug("Updating shape from notifyScoreChange"),this.getUpdateWidgetStateAnimation().play())},e.prototype.setLoading=function(e){var t=this;this.widgetReady.then(function(){console.debug("Calling setLoading("+e+")"),null!==t.widgetElement?(t.isLoading=e,t.loadingIconStyle===E.CIRCLE_SQUARE_DIAMOND?t.setLoadingForDefaultWidget(e):t.loadingIconStyle===E.EMOJI?t.setLoadingForEmojiWidget(e):console.error("Calling setLoading for unknown loadingIconStyle: "+t.loadingIconStyle)):console.error("this.widgetElement = null in call to setLoading")})},e.prototype.getChangeOpacityAnimation=function(e,t,n){return s.TweenMax.to(e,t,{opacity:n})},e.prototype.getShowEmojiAnimation=function(){var e=this;if(this.loadingIconStyle!==E.EMOJI)return console.debug("Calling getShowEmojiAnimation() but loading icon style isnot emoji style, returning an empty timeline"),new s.TimelineMax({});var t=null;t=this.score>this.scoreThresholds[2]?S.SAD:this.score>this.scoreThresholds[1]?S.NEUTRAL:S.SMILE;var n=this.getEmojiElementFromEmojiType(t),i=new s.TimelineMax({onStart:function(){e.ngZone.run(function(){e.hideEmojiIconsForLoadingAnimation=!1})},onComplete:function(){e.ngZone.run(function(){e.currentEmoji=t})}}),o=this.getChangeColorAnimation(.2,T);return i.add(this.getFadeAndShrinkAnimation(.3,!1)),i.add([o,this.getToFullScaleBounceAnimation(1),this.getChangeOpacityAnimation(n,.5,1)]),i},e.prototype.getHideEmojisAnimation=function(){var e=this,t=new s.TimelineMax({onComplete:function(){e.ngZone.run(function(){e.hideEmojiIconsForLoadingAnimation=!0})}});return t.add([this.getChangeOpacityAnimation(this.smileEmoji.nativeElement,.5,0),this.getChangeOpacityAnimation(this.neutralEmoji.nativeElement,.5,0),this.getChangeOpacityAnimation(this.sadEmoji.nativeElement,.5,0)]),t},e.prototype.getStartAnimationsForEmojiWidgetLoading=function(){var e=new s.TimelineMax({});return 0!==this.currentLayerIndex&&e.add(this.getTransitionToLayerAnimation(0,v)),e.add(this.getUpdateStatusWidgetVisibilityAnimation(!0)),e.add(this.getFadeDetailsAnimation(.4,!0,0)),e.add([this.getHideEmojisAnimation(),this.getChangeColorAnimation(.5,T)]),e},e.prototype.getLoopAnimationForEmojiWidgetLoading=function(){var e=new s.TimelineMax({ease:s.Power3.easeInOut});return e.add(this.getFadeAndShrinkAnimation(.3,!0)),e},e.prototype.getEndAnimationsForEmojiWidgetLoading=function(e){var t=this,n=new s.TimelineMax({onComplete:function(){t.ngZone.run(function(){console.debug("Setting this.isPlayingLoadingAnimation = false (emoji)"),t.isPlayingLoadingAnimation=!1,e.clear(),t.scoreChangeAnimationCompleted.emit(),t.isLoading?(console.debug("Restarting loading from ending animation completion"),t.setLoading(!0)):t.currentEmoji!==t.getEmojiForScore(t.score)&&(console.debug("Load ending animation completed, found an out of date shape"),t.notifyScoreChange(t.score))})}}),i=[];return i.push(this.getShowEmojiAnimation()),i.push(this.getFadeDetailsAnimation(.4,!1,0)),this.getShouldHideStatusWidget(!1)||n.add(this.getUpdateStatusWidgetVisibilityAnimation(!1)),n.add(i),this.getShouldHideStatusWidget(!1)&&n.add(this.getUpdateStatusWidgetVisibilityAnimation(!1)),this.pendingPostLoadingStateChangeAnimations&&n.add(this.pendingPostLoadingStateChangeAnimations),n},e.prototype.getStartAnimationsForCircleSquareDiamondWidgetLoading=function(){var e=new s.TimelineMax({align:"sequence"}),t=[],n=[],i=[];return t.push(this.getUpdateStatusWidgetVisibilityAnimation(!0)),i.push(this.getToGrayScaleAnimation(.2)),this.showScore&&(0!==this.currentLayerIndex&&n.push(this.getTransitionToLayerAnimation(0,v)),i.push(this.getFadeDetailsAnimation(.4,!0,0))),e.add(t),e.add(n),e.add(i),e},e.prototype.getLoopAnimationsForCircleSquareDiamondWidgetLoading=function(){var e=new s.TimelineMax({ease:s.Power3.easeInOut});return e.add(this.getFadeAndShrinkAnimation(.3,!0)),e},e.prototype.getEndAnimationsForCircleSquareDiamondWidgetLoading=function(e){var t=this,n=new s.TimelineMax({onStart:function(){console.debug("Score change animation start")},onComplete:function(){t.ngZone.run(function(){console.debug("Score change animation end"),console.debug("Clearing loadingTimeline"),t.isPlayingLoadingAnimation=!1,e.clear(),t.scoreChangeAnimationCompleted.emit(),t.isLoading?(console.debug("Restarting loading from ending animation completion"),t.setLoading(!0)):t.currentShape!==t.getShapeForScore(t.score)&&(console.debug("Load ending animation completed, found an out of date shape"),t.notifyScoreChange(t.score))})}}),i=[];return i.push(this.getUpdateShapeAnimation(this.score)),this.showScore&&i.push(this.getFadeDetailsAnimation(.4,!1,0)),this.getShouldHideStatusWidget(!1)||n.add(this.getUpdateStatusWidgetVisibilityAnimation(!1)),n.add(i),this.getShouldHideStatusWidget(!1)&&n.add(this.getUpdateStatusWidgetVisibilityAnimation(!1)),this.pendingPostLoadingStateChangeAnimations&&n.add(this.pendingPostLoadingStateChangeAnimations),n},e.prototype.setLoadingForEmojiWidget=function(e){var t=this;if(e&&!this.isPlayingLoadingAnimation){this.isPlayingLoadingAnimation=!0;var n=new s.TimelineMax({paused:!0,ease:s.Power3.easeInOut,onStart:function(){t.ngZone.run(function(){console.debug("Starting timeline (emoji)")})},onComplete:function(){t.ngZone.run(function(){console.debug("Completing timeline (emoji)"),t.isLoading?(console.debug("Restarting main emoji loading animation"),n.seek(L,!0)):t.getEndAnimationsForEmojiWidgetLoading(n).play()})}});n.add(this.getStartAnimationsForEmojiWidgetLoading()),n.add(this.getLoopAnimationForEmojiWidgetLoading(),L),n.play()}},e.prototype.setLoadingForDefaultWidget=function(e){var t=this;if(e&&!this.isPlayingLoadingAnimation){console.debug("About to create loadingTimeline"),this.isPlayingLoadingAnimation=!0;var n=new s.TimelineMax({paused:!0,ease:s.Power3.easeInOut,onStart:function(){t.ngZone.run(function(){console.debug("Starting timeline")})},onComplete:function(){t.ngZone.run(function(){(console.debug("Completing timeline"),console.debug("Updating shape from animation complete"),t.isLoading)?(console.debug("Restarting loading to fade animation."),n.seek(x,!0)):(console.debug("Loading complete"),console.debug("hasScore:",t.hasScore),t.getEndAnimationsForCircleSquareDiamondWidgetLoading(n).play())})}}),i=this.getStartAnimationsForCircleSquareDiamondWidgetLoading();n.add(i,"loadingAnimationStart"),n.add(this.getLoopAnimationsForCircleSquareDiamondWidgetLoading(),x),n.play()}},e.prototype.getNameFromShape=function(e){return e==y.CIRCLE?"circle":e==y.SQUARE?"square":"diamond"},e.prototype.getAccessibilityDescriptionForShape=function(e){return e==y.CIRCLE?"Low toxicity icon.":e==y.SQUARE?"Medium toxicity icon.":"High toxicity icon."},e.prototype.getUpdateGradientColorAnimation=function(e){return this.getChangeColorAnimation(e,this.interpolateColors(this.score))},e.prototype.getChangeColorAnimation=function(e,t){return s.TweenMax.to(this.widgetElement,e,{backgroundColor:t})},e.prototype.getTransitionToCircleAnimation=function(e,t){var n=new s.TimelineMax({align:"start",onStart:function(){},onComplete:function(){}});return n.add([this.getCircleAnimation(e/6,t),this.getToFullScaleBounceAnimation(e)]),n},e.prototype.getTransitionToSquareAnimation=function(e){var n=this,t=new s.TimelineMax({onStart:function(){var e=0,t=n.widgetElement._gsTransform;t!==undefined&&(e=t.rotation),console.debug("getTransitionToSquare; Current rotation:",e)},onComplete:function(){}}),i=this.currentShape;return t.add([this.getSquareAnimation(e/4),this.getToFullScaleCompleteRotationAnimation(e,i)]),t},e.prototype.getTransitionToDiamondAnimation=function(e){var t=new s.TimelineMax({onStart:function(){},onComplete:function(){}});return t.add([this.getDiamondAnimation(e/6),this.getToFullScaleAnimation(e/6)]),t.add(this.getRotateBackAndForthAnimation(e/6,85)),t.add(this.getRotateBackAndForthAnimation(e/6,5)),t.add(this.getRotateBackAndForthAnimation(e/6,65)),t.add(this.getRotateBackAndForthAnimation(e/6,25)),t.add(this.getRotateBackAndForthAnimation(e/6,45)),t},e.prototype.getRotateBackAndForthAnimation=function(e,t){return s.TweenMax.to(this.widgetElement,e,{rotation:t,onStart:function(){console.debug("Starting rotate back and forth animation")},onComplete:function(){console.debug("Rotate back and forth animation completed")}})},e.prototype.getToFullScaleBounceAnimation=function(e){return s.TweenMax.to(this.widgetElement,e,{scaleX:1,scaleY:1,ease:s.Elastic.easeOut.config(1,.3),onStart:function(){console.debug("Starting get to full scale bounce animation")},onComplete:function(){console.debug("Get to full scale bounce animation completed")}})},e.prototype.getToFullScaleAnimation=function(e){return s.TweenMax.to(this.widgetElement,e,{scaleX:1,scaleY:1,onStart:function(){console.debug("Starting get to full scale animation")},onComplete:function(){console.debug("Get to full scale animation completed")}})},e.prototype.getToFullScaleCompleteRotationAnimation=function(e,t){var n=0,i=this.widgetElement._gsTransform;i!==undefined&&(n=i.rotation),console.debug("Current rotation:",n),console.debug("From shape:",this.getNameFromShape(t));var o=t===y.DIAMOND?315:360;return s.TweenMax.to(this.widgetElement,e,{rotation:"+="+o+"_ccw",scaleX:1,scaleY:1,ease:s.Elastic.easeOut.config(1,.3),onStart:function(){console.debug("Starting get to full scale complete rotation animation")},onComplete:function(){console.debug("Get to full scale complete rotation animation completed")}})},e.prototype.getTransitionToLayerAnimation=function(e,t){var n=this;this.layerHeightPixels=this.layerAnimationHandles[this.currentLayerIndex].offsetHeight;var i=new s.TimelineMax({onStart:function(){n.ngZone.run(function(){console.debug("Transitioning from layer "+n.currentLayerIndex+" to layer "+e),n.layersAnimating=!0})},onComplete:function(){n.ngZone.run(function(){n.layersAnimating=!1,n.currentLayerIndex=e,console.debug("Finished transitioning to layer "+n.currentLayerIndex),n.showingMoreInfo=1===n.currentLayerIndex,n.updateLayerElementContainers()})}});if(this.currentLayerIndex===e)return i;var o=this.layerAnimationHandles[this.currentLayerIndex],a=this.layerAnimationHandles[e];return this.currentLayerIndex<e?i.add([this.getShiftLayerVerticallyAnimation(o,t,0,-1*this.layerHeightPixels,!1),this.getShiftLayerVerticallyAnimation(a,t,this.layerHeightPixels,0,!0)]):i.add([this.getShiftLayerVerticallyAnimation(o,1,0,this.layerHeightPixels,!1),this.getShiftLayerVerticallyAnimation(a,1,-1*this.layerHeightPixels,0,!0)]),i},e.prototype.getShiftLayerVerticallyAnimation=function(e,t,n,i,o){return s.TweenMax.fromTo(e,t,{y:n,opacity:o?0:1},{y:i,opacity:o?1:0})},e.prototype.getCircleAnimation=function(e,t){var n=this;return t||(t=this.interpolateColors(this.score)),s.TweenMax.to(this.widgetElement,e,{rotation:0,borderRadius:"50%",backgroundColor:t,onStart:function(){console.debug("Loading animation: Morphing to circle from "+n.getNameFromShape(n.currentShape)),n.currentShape=y.CIRCLE},onComplete:function(){console.debug("Loading animation: done morphing to circle.")}})},e.prototype.getSquareAnimation=function(e){var t=this;return s.TweenMax.to(this.widgetElement,e,{rotation:0,borderRadius:0,backgroundColor:this.interpolateColors(this.score),onStart:function(){console.debug("Morphing to square from "+t.getNameFromShape(t.currentShape)),t.currentShape=y.SQUARE},onComplete:function(){console.debug("Done morphing to square")}})},e.prototype.getDiamondAnimation=function(e){var t=this;return s.TweenMax.to(this.widgetElement,e,{borderRadius:0,rotation:45,backgroundColor:this.interpolateColors(this.score),onStart:function(){console.debug("Morphing to diamond from "+t.getNameFromShape(t.currentShape)),t.currentShape=y.DIAMOND},onComplete:function(){console.debug("Done morphing to diamond.")}})},e.prototype.getToGrayScaleAnimation=function(e){return s.TweenMax.to(this.widgetElement,e,{backgroundColor:"rgba(227,229,230,1)"})},e.prototype.getFadeAndShrinkAnimation=function(e,t){return s.TweenMax.to(this.widgetElement,e,{repeat:t?1:0,backgroundColor:"rgba(227,229,230,0.54)",scaleX:.5,scaleY:.5,yoyo:t,onStart:function(){console.debug("Loading animation: fade in and out start")},onComplete:function(){console.debug("Loading animation: fade in and out complete")}})},e.prototype.getFadeDetailsAnimation=function(e,t,n){var i=this,o=new s.TimelineMax({onStart:function(){i.ngZone.run(function(){console.debug("Calling getFadeDetails animation, fadeOut="+t+" and current layer index = "+i.currentLayerIndex),i.isPlayingFadeDetailsAnimation=!0})},onComplete:function(){i.ngZone.run(function(){console.debug("Fade details animation complete"),i.isPlayingFadeDetailsAnimation=!1})}}),a=this.elementRef.nativeElement.querySelector(this.layerAnimationSelectors[n]+" .interactiveElement"),r=this.elementRef.nativeElement.querySelector(this.layerAnimationSelectors[n]+" .layerText");return o.add([s.TweenMax.to(a,e,{opacity:t?0:1}),s.TweenMax.to(r,e,{opacity:t?0:1})],0,"normal",0),o},e}();w.decorators=[{type:n.Component,args:[{selector:"perspective-status",template:'<div #widgetContainer id="widgetContainer" class="horizontal-container">\n  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"\n        rel="stylesheet">\n  \x3c!-- For items that need to be animated, hidden is used instead of *ngIf.\n       This is because *ngIf removes items from the DOM, which means they\n       cannot be found when the component is initializing if their display\n       conditions are not met. --\x3e\n  <div id="animationContainer">\n    <div *ngIf="loadingIconStyle === loadingIconStyleConst.CIRCLE_SQUARE_DIAMOND"\n         id="circleSquareDiamondLoadingIconContainer">\n      <div\n           #circleSquareDiamondWidget\n           id="circleSquareDiamondWidget"\n           class="dot"\n           [style.width]="indicatorWidth"\n           [style.height]="indicatorHeight"\n           [hidden]="shouldHideStatusWidget || alwaysHideLoadingIcon"\n           [attr.aria-hidden]="shouldHideStatusWidget || isPlayingShowOrHideLoadingWidgetAnimation || alwaysHideLoadingIcon"\n           [attr.aria-label]="getAnimationA11yLabel(loadingIconStyle, isPlayingLoadingAnimation)"\n           tabindex=0>\n      </div>\n    </div>\n    <div *ngIf="loadingIconStyle === loadingIconStyleConst.EMOJI">\n      <div\n           #emojiStatusWidget\n           id="emojiStatusWidget"\n           class="dot emojiWidget"\n           tabindex=0\n           [attr.aria-label]="getAnimationA11yLabel(loadingIconStyle, isPlayingLoadingAnimation)">\n        <img #smileEmoji id="smileEmoji" class="iconEmoji"\n             [ngClass]="{hiddenEmoji: hideEmojiIconsForLoadingAnimation || score >= scoreThresholds[1]}"\n             src="assets/grinning_face.png">\n        <img #neutralEmoji id="neutralEmoji" class="iconEmoji"\n             [ngClass]="{hiddenEmoji: hideEmojiIconsForLoadingAnimation || (score < scoreThresholds[1] || score >= scoreThresholds[2])}"\n             src="assets/thinking_face.png">\n        <img #sadEmoji id="sadEmoji" class="iconEmoji"\n             [ngClass]="{hiddenEmoji: hideEmojiIconsForLoadingAnimation || score < scoreThresholds[2]}"\n             src="assets/disappointed_face.png">\n      </div>\n    </div>\n  </div>\n\n  <div class="layersContainer">\n    \x3c!-- TODO(rachelrosen): Check the necessity of specifying aria-hidden here and elsewhere. --\x3e\n    <div id="layer1" [ngClass]="{\'horizontal-container\': true,\n                                 \'detailsContainer\': true,\n                                 \'layer\': true,\n                                 \'hiddenLayer\': !layersAnimating && currentLayerIndex !== 0}"\n                     [attr.aria-hidden]="currentLayerIndex !== 0">\n      <div id="layerText" class="layerText">\n        \x3c!-- For layer 1 text, configurations EXTERNAL and DEMO_SITE are the same.--\x3e\n        <div>\n          <div id="noBorderButtonscoreInfo"\n               class="widgetText"\n               *ngIf="hasScore && !analyzeErrorMessage && shouldShowFeedback(score)"\n               [style.fontSize]="fontSize"\n               tabindex=0\n               role="status"\n               [attr.aria-hidden]="!showScore || isPlayingLoadingAnimation || isPlayingFadeDetailsAnimation">\n            <span id="feedbackText" [innerHTML]="parseEmojis(getFeedbackTextForScore(score))"></span><span *ngIf="showPercentage" id="percentage">({{score.toFixed(2)}})</span><span\n               *ngIf="showMoreInfoLink"\n               class="link"\n               role="link"\n               tabindex=0\n               (keyup.enter)="notifyModelInfoLinkClicked()"\n               (keyup.space)="notifyModelInfoLinkClicked()"\n               (click)="notifyModelInfoLinkClicked()">Learn more</span>\n          </div>\n\n          <div class="error" *ngIf="initializeErrorMessage">\n            {{initializeErrorMessage}}\n          </div>\n          <div class="error" *ngIf="analyzeErrorMessage">\n            {{analyzeErrorMessage}}\n          </div>\n        </div>\x3c!-- End configuration DEMO_SITE or EXTERNAL --\x3e\n\n      </div> \x3c!-- End layerText --\x3e\n\n      <div class="interactiveElement">\n        <div *ngIf="configuration === configurationEnum.EXTERNAL">\n          <div id="infoButtonContainer" class="infoButtonContainer">\n            <button *ngIf="hasScore && shouldShowFeedback(score)"\n              id="infoButton"\n              class="infoButton"\n              role="button"\n              aria-label="Show score details"\n              [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n              (click)="setShowMoreInfo(true)"\n              tabindex=0>\n              <i class="material-icons md-dark md-18">info</i>\n            </button>\n          </div>\n        </div> \x3c!-- End configuration EXTERNAL--\x3e\n\n        <div *ngIf="configuration === configurationEnum.DEMO_SITE">\n          <button id="seemWrongButtonDemoConfig"\n               *ngIf="canAcceptFeedback && shouldShowFeedback(score)"\n               role="button"\n               class="seemWrongButton purpleButton noBorderButton"\n               [style.fontSize]="fontSize"\n               [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n               (click)="feedbackContainerClicked()"\n               tabindex=0>\n            {{userFeedbackPromptText}}\n          </button>\n        </div>\n\n      </div> \x3c!-- End interactiveElement --\x3e\n    </div> \x3c!-- End layer1 --\x3e\n\n    <div id="layer2" [ngClass]="{\'horizontal-container\': true,\n                                 \'detailsContainer\': true,\n                                 \'layer\': true,\n                                 \'hiddenLayer\': !layersAnimating && currentLayerIndex !== 1}"\n                     [attr.aria-hidden]="currentLayerIndex !== 1">\n\n      <div class="layerText">\n        <div *ngIf="configuration === configurationEnum.EXTERNAL">\n          <div id="detailedScoreInfo"\n               class="widgetText"\n               role="status"\n               tabindex=0>\n            <span>Scored {{(score.toFixed(2) * 100).toFixed(0)}}% by the <a href="https://conversationai.github.io/">Perspective "Toxicity" analyzer</a>\n            </span>\n          </div>\n        </div> \x3c!-- End configuration EXTERNAL--\x3e\n\n        <div *ngIf="configuration === configurationEnum.DEMO_SITE">\n          <div class="widgetText"\n            tabindex=0>\n            <span>Is this comment\n              <span class="link"\n                    role="link"\n                    tabindex=0\n                    (keyup.enter)="notifyModelInfoLinkClicked()"\n                    (keyup.space)="notifyModelInfoLinkClicked()"\n                    (click)="notifyModelInfoLinkClicked()">toxic</span>?\n            </span>\n          </div>\n        </div> \x3c!-- End configuration DEMO_SITE --\x3e\n\n      </div> \x3c!-- End layerText --\x3e\n\n      <div class="interactiveElement">\n\n        <div *ngIf="configuration === configurationEnum.EXTERNAL">\n          <div class="horizontal-container">\n            <div class="feedbackContainer widgetText"\n                 [style.fontSize]="fontSize"\n                 [attr.aria-hidden]="!showScore || isPlayingLoadingAnimation">\n              <button id="seemWrongButton"\n                   *ngIf="canAcceptFeedback && !showFeedbackQuestion\n                      && !feedbackRequestInProgress && !feedbackRequestSubmitted && !feedbackRequestError"\n                   role="button"\n                   class="seemWrongButton greyButton noBorderButton"\n                   [style.fontSize]="fontSize"\n                   [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n                   (click)="feedbackContainerClicked()"\n                   tabindex=0>\n                {{userFeedbackPromptText}}\n              </button>\n              <div id="seemWrongQuestion" *ngIf="showFeedbackQuestion && !feedbackRequestInProgress">\n                <div class="feedbackQuestion widgetText" tabindex=0>Is this text toxic?</div>\n                <div class="yesNoButtonContainer horizontal-container">\n                  <div>\n                    <button\n                      id="yesButtonExternalConfig"\n                      class="yesNoButton greyButton underlineButton noBorderButton"\n                      role="button"\n                      [style.fontSize]="fontSize"\n                      [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n                      (click)="submitFeedback(true)"\n                      tabindex=0>\n                      Yes\n                    </button>\n                  </div>\n                  <div>\n                    <button\n                      id="noButtonExternalConfig"\n                      class="yesNoButton greyButton underlineButton noBorderButton"\n                      role="button"\n                      [style.fontSize]="fontSize"\n                      [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n                      (click)="submitFeedback(false)"\n                      tabindex=0>\n                      No\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <div id="feedbackSubmitting"\n                   tabindex=0\n                   role="status"\n                   *ngIf="feedbackRequestInProgress">\n                Sending...\n              </div>\n              <div id="feedbackThanks"\n                   tabindex=0\n                   role="status"\n                   *ngIf="feedbackRequestSubmitted">\n                Thanks for the feedback!\n              </div>\n              <div *ngIf="feedbackRequestError">\n                <button\n                     class="error noBorderButton"\n                     role="button"\n                     [style.fontSize]="fontSize"\n                     (click)="resetFeedback()"\n                     tabindex=0>\n                  Error submitting feedback. Click to try again.\n                </button>\n              </div>\n            </div>\n            <div id="infoButtonContainer" class="infoButtonContainer">\n              <button *ngIf="hasScore"\n                id="cancelButton"\n                class="infoButton"\n                role="button"\n                aria-label="Hide score details"\n                [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n                (click)="setShowMoreInfo(false)"\n                tabindex=0>\n                <i class="material-icons md-dark md-18">cancel</i>\n              </button>\n            </div>\n          </div>\n        </div> \x3c!-- End configuration EXTERNAL --\x3e\n\n        <div *ngIf="configuration === configurationEnum.DEMO_SITE">\n          <div class="yesNoButtonContainer horizontal-container"\n               *ngIf="!feedbackRequestInProgress && !feedbackRequestSubmitted && !feedbackRequestError">\n            <div>\n              <button\n                id="yesButtonDemoConfig"\n                class="yesNoButton purpleButton noBorderButton"\n                role="button"\n                [style.fontSize]="fontSize"\n                [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n                (click)="submitFeedback(true)"\n                tabindex=0>\n                Yes\n              </button>\n            </div>\n            <div>\n              <button\n                id="noButtonDemoConfig"\n                class="yesNoButton purpleButton noBorderButton"\n                role="button"\n                [style.fontSize]="fontSize"\n                [disabled]="!showScore || isPlayingLoadingAnimation || layersAnimating"\n                (click)="submitFeedback(false)"\n                tabindex=0>\n                No\n              </button>\n            </div>\n          </div>\n        </div> \x3c!-- End configuration DEMO_SITE --\x3e\n\n      </div> \x3c!-- End layer2 interactive element --\x3e\n\n    </div> \x3c!-- End layer2 --\x3e\n\n    <div id="layer3" [ngClass]="{\'horizontal-container\': true,\n                                 \'detailsContainer\': true,\n                                 \'hiddenLayer\': !layersAnimating && currentLayerIndex !== 2}">\n      <div class="interactiveElement">\n\n        <div *ngIf="configuration === configurationEnum.DEMO_SITE">\n            <div id="feedbackThanksDemoConfig"\n                 class="widgetText"\n                 tabindex=0\n                 role="status"\n                 *ngIf="feedbackRequestSubmitted">\n              <button\n                id="thanksForFeedbackButtonDemoConfig"\n                class="noBorderButton feedbackResponseButton widgetText"\n                role="button"\n                (click)="resetLayers()">\n                Thanks for your feedback!\n              </button>\n            </div>\n            <div *ngIf="feedbackRequestError">\n              <button\n                   class="error noBorderButton feedbackResponseButton"\n                   role="button"\n                   [style.fontSize]="fontSize"\n                   (click)="resetLayers()"\n                   tabindex=0>\n                Error submitting feedback. Click to try again.\n              </button>\n            </div>\n        </div> \x3c!-- End configuration DEMO_SITE. --\x3e\n      </div> \x3c!-- End interactiveElement. --\x3e\n    </div> \x3c!-- End layer3 --\x3e\n\n  </div>\n</div>\n',styles:[".horizontal-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.center-perp-axis{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.dot{border-radius:50%;border:0;background-color:#00bcd4;margin:2px;padding:0;width:13px;height:13px;vertical-align:top}#circleSquareDiamondLoadingIconContainer{padding-top:2px}.emojiWidget{background-color:#ffcc4d;width:16px;height:16px}.iconEmoji{width:16px;height:16px;opacity:0}.hiddenEmoji{display:none}#animationContainer{z-index:5;width:20px;height:22px;margin-right:10px}#scoreInfoContainer{padding-top:2px}.widgetText{color:#6e7378;font-size:12px;line-height:16px;letter-spacing:.05em;width:100%}#feedbackText,#percentage{margin-right:4px}.widgetText a{color:#6e7378!important}.link{text-decoration:underline;cursor:pointer}.layerText{padding-right:10px;padding-top:2px}#detailedScoreInfo a{width:40%;color:#6e7378!important}.feedbackQuestion{margin-right:4px}.seemWrongButton{font-size:12px;font-family:Roboto,sans-serif;line-height:16px;letter-spacing:.05em;-ms-flex-item-align:start;align-self:flex-start}.detailsContainer{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%;margin-top:1px}.layersContainer{width:100%;position:relative}.layer{position:absolute}.hiddenLayer{display:none!important}.interactiveElement{vertical-align:top;text-align:end;margin-left:auto;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;min-width:-webkit-fit-content;min-width:-moz-fit-content;min-width:fit-content;padding-top:1px}.interactiveElement .feedbackContainer{padding-top:2px}#layer3 .interactiveElement{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;margin-left:0;padding-top:2px}.noBorderButton{background-color:#fff;border:0;cursor:pointer;padding-top:0;font-family:Roboto,sans-serif}.feedbackResponseButton{padding-left:0}.purpleButton{color:#6200ea;text-transform:uppercase}.greyButton{color:#6e7378}.underlineButton{text-decoration:underline}.yesNoButton{font-size:12px;font-family:Roboto,sans-serif;line-height:16px;letter-spacing:.05em}.yesNoButton.purpleButton{margin-left:8px;margin-right:8px}.yesNoButtonContainer{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}#widgetContainer{height:50px}.error{font-size:12px;letter-spacing:.05em;line-height:16px;color:#f44336}.infoButtonContainer{margin-left:10px;width:26px;height:26px}.infoButton{background-color:transparent;border:none;cursor:pointer}.material-icons.md-18{font-size:18px}.material-icons.md-dark{color:#78909c}.material-icons.md-dark.md-inactive{color:rgba(0,0,0,.26)}"]}]},{type:n.Injectable}],w.ctorParameters=function(){return[{type:n.NgZone},{type:n.ElementRef}]},w.propDecorators={indicatorWidth:[{type:n.Input}],indicatorHeight:[{type:n.Input}],configurationInput:[{type:n.Input}],hasScore:[{type:n.Input}],fontSize:[{type:n.Input}],gradientColors:[{type:n.Input}],canAcceptFeedback:[{type:n.Input}],feedbackRequestInProgress:[{type:n.Input}],feedbackRequestSubmitted:[{type:n.Input}],feedbackRequestError:[{type:n.Input}],initializeErrorMessage:[{type:n.Input}],feedbackText:[{type:n.Input}],scoreThresholds:[{type:n.Input}],showPercentage:[{type:n.Input}],showMoreInfoLink:[{type:n.Input}],analyzeErrorMessage:[{type:n.Input}],userFeedbackPromptText:[{type:n.Input}],hideLoadingIconAfterLoad:[{type:n.Input}],hideLoadingIconForScoresBelowMinThreshold:[{type:n.Input}],alwaysHideLoadingIcon:[{type:n.Input}],loadingIconStyle:[{type:n.Input}],scoreChangeAnimationCompleted:[{type:n.Output}],modelInfoLinkClicked:[{type:n.Output}],commentFeedbackSubmitted:[{type:n.Output}],circleSquareDiamondWidget:[{type:n.ViewChild,args:["circleSquareDiamondWidget"]}],emojiWidget:[{type:n.ViewChild,args:["emojiStatusWidget"]}],container:[{type:n.ViewChild,args:["widgetContainer"]}],smileEmoji:[{type:n.ViewChild,args:["smileEmoji"]}],neutralEmoji:[{type:n.ViewChild,args:["neutralEmoji"]}],sadEmoji:[{type:n.ViewChild,args:["sadEmoji"]}]};var M="TOXICITY",R=function(){function e(e){this.http=e,this.gapiClient=null}return e.prototype.initGapiClient=function(e){var t=this;e||(this.gapiClient=null),gapi.load("client",function(){console.log("Starting to load gapi client"),gapi.client.init({apiKey:e,discoveryDocs:["https://commentanalyzer.googleapis.com/$discovery/rest?version=v1alpha1"]}).then(function(){console.log("Finished loading gapi client"),console.log(gapi.client),t.gapiClient=gapi.client},function(e){console.error("Error loading gapi client:",e)})})},e.prototype.checkText=function(e,t,n,i,o){if(i&&null===this.gapiClient&&(console.error("No gapi client found; call initGapiClient with your APIkey to make a direct API call. Using server instead"),i=!1),i){console.debug("Making a direct API call with gapi");var a={TOXICITY:{}},r={comment:{text:e},requested_attributes:a,session_id:t,community_id:n};return c.from(this.gapiClient.commentanalyzer.comments.analyze(r)).pipe(g.map(function(e){return e.result}))}o===undefined&&(o="",console.error("No server url specified for a non-direct API call. Defaulting to current hosted address"));var s=new l.Headers;s.append("Content-Type","application/json");var d={comment:e,sessionId:t,communityId:n};return this.http.post(o+"/check",JSON.stringify(d),{headers:s}).pipe(g.map(function(e){return e.json()}))},e.prototype.suggestScore=function(e,t,n,i,o){if(i&&null===this.gapiClient&&(console.error("No gapi client found; call initGapiClient with your APIkey to make a direct API call. Using server instead"),i=!1),i){var a={};a[M]={summaryScore:{value:n?1:0}};var r={comment:{text:e},attribute_scores:a,client_token:t};return console.debug("Making a direct API call with gapi"),c.from(this.gapiClient.commentanalyzer.comments.suggestscore(r)).pipe(g.map(function(e){return e.result}))}o===undefined&&(o="",console.error("No server url specified for a non-direct API call. Defaulting to current hosted address"));var s=new l.Headers;s.append("Content-Type","application/json");var d={comment:e,sessionId:t,commentMarkedAsToxic:n};return this.http.post(o+"/suggest_score",JSON.stringify(d),{headers:s}).pipe(g.map(function(e){return e.json()}))},e}();R.decorators=[{type:n.Injectable}];var F={configuration:"default",gradientColors:["#25C1F9","#7C4DFF","#D400F9"],apiKey:"",useGapi:!(R.ctorParameters=function(){return[{type:l.Http}]}),usePluginEndpoint:!1,showPercentage:!0,showMoreInfoLink:!0,feedbackText:["Unlikely to be perceived as toxic","Unsure if this will be perceived as toxic","Likely to be perceived as toxic"],scoreThresholds:[0,.4,.7],hideLoadingIconAfterLoad:!1,hideLoadingIconForScoresBelowMinThreshold:!1,alwaysHideLoadingIcon:!1,loadingIconStyle:E.CIRCLE_SQUARE_DIAMOND,userFeedbackPromptText:"Seem wrong?"},P=function(){function e(e,t){this.elementRef=e,this.analyzeApiService=t,this.fontSize=12,this.demoSettings=F,this.demoSettingsJson=null,this.pluginEndpointUrl="http://perspectiveapi.com",this.scoreChangeAnimationCompleted=new n.EventEmitter,this.scoreChanged=new n.EventEmitter,this.modelInfoLinkClicked=new n.EventEmitter,this.analyzeCommentResponseChanged=new n.EventEmitter,this.analyzeCommentResponse=null,this.analyzeErrorMessage=null,this.canAcceptFeedback=!1,this.feedbackRequestInProgress=!1,this.sessionId=null,this.gradientColors=["#25C1F9","#7C4DFF","#D400F9"],this.inputId=this.elementRef.nativeElement.getAttribute("inputId"),this.serverUrl=this.elementRef.nativeElement.getAttribute("serverUrl")||""}return e.prototype.ngOnInit=function(){this.inputId?(this.demoSettingsJson&&(this.demoSettings=JSON.parse(this.demoSettingsJson),this.demoSettings.apiKey&&(this.apiKey=this.demoSettings.apiKey)),this.apiKey&&this.analyzeApiService.initGapiClient(this.apiKey),this.sessionId=window.localStorage.getItem(j),null===this.sessionId&&(this.sessionId=Math.round(Date.now()*Math.random()).toString(),window.localStorage.setItem(j,this.sessionId))):this.initializeErrorMessage="Error initializing: No input element id specified. Set inputId=<inputElementId> to use this component."},e.prototype.ngOnChanges=function(e){e.demoSettings&&this.demoSettings&&this.demoSettings.apiKey&&this.apiKey!==this.demoSettings.apiKey&&(console.debug("Api key changes detected in demoSettings"),this.apiKey=this.demoSettings.apiKey,this.analyzeApiService.initGapiClient(this.apiKey))},e.prototype.checkText=function(e){this._handlePendingCheckRequest(e)},e.prototype._handleInputEvent=function(e){e.target.id===this.inputId&&this._handlePendingCheckRequest(e.target.value)},e.prototype._handlePendingCheckRequest=function(e){var t=this;if(e!==this.lastRequestedText&&e!==this.lastPendingRequestedText){if(console.debug("Clearing this.pendingRequest"),clearTimeout(this.pendingRequest),this.analyzeErrorMessage=null,!e)return this.analyzeCommentResponse=null,this.analyzeCommentResponseChanged.emit(this.analyzeCommentResponse),this.statusWidget.notifyScoreChange(0),this.scoreChanged.emit(0),this.canAcceptFeedback=!1,void this.statusWidget.resetFeedback();this.lastPendingRequestedText=e,this.statusWidget.setLoading(!0),console.debug("Updating this.pendingRequest for text: ",e),this.pendingRequest=window.setTimeout(function(){t._checkText(e)},D)}else console.debug("Duplicate request text "+e+"; returning")},e.prototype.onCommentFeedbackReceived=function(e){null!==this.analyzeCommentResponse&&this.suggestCommentScore(this.lastRequestedText,e)},e.prototype.handleScoreChangeAnimationCompleted=function(){this.scoreChangeAnimationCompleted.emit(),console.debug("Score animation completed! Emitting an event")},e.prototype.handleModelInfoLinkClicked=function(){this.modelInfoLinkClicked.emit()},e.prototype.suggestCommentScore=function(e,t){var n=this;this.feedbackRequestInProgress=!0,this.analyzeApiService.suggestScore(e,this.sessionId,t.commentMarkedAsToxic,this.demoSettings.useGapi,this.serverUrl).pipe(g.finalize(function(){console.debug("Feedback request done"),n.statusWidget.hideFeedbackQuestion(),n.feedbackRequestInProgress=!1})).subscribe(function(e){n.statusWidget.feedbackCompleted(!0),console.log(e)},function(e){console.error("Error",e),n.statusWidget.feedbackCompleted(!1)})},e.prototype._getErrorMessage=function(e){var t,n,i="Error scoring text. Please try again.";try{try{for(var o=f(e.json().errors),a=o.next();!a.done;a=o.next()){if(a.value.message.includes("does not support request languages")){i="Sorry! Perspective needs more training data to work in this language.";break}}}catch(r){t={error:r}}finally{try{a&&!a.done&&(n=o["return"])&&n.call(o)}finally{if(t)throw t.error}}}catch(s){console.warn("Failed to parse error. ",s)}return i},e.prototype._checkText=function(e){var t=this;this.mostRecentRequestSubscription&&this.mostRecentRequestSubscription.unsubscribe(),this.statusWidget.resetFeedback(),console.log("Checking text "+e),this.lastRequestedText=e,this.checkInProgress=!0,this.mostRecentRequestSubscription=this.analyzeApiService.checkText(e,this.sessionId,this.demoSettings.communityId,this.demoSettings.useGapi,this.demoSettings.usePluginEndpoint?this.pluginEndpointUrl:this.serverUrl).pipe(g.finalize(function(){console.log("Request done");var e=t.getMaxScore(t.analyzeCommentResponse);t.statusWidget.notifyScoreChange(e),t.scoreChanged.emit(e),t.mostRecentRequestSubscription=null})).subscribe(function(e){t.analyzeCommentResponse=e,t.analyzeCommentResponseChanged.emit(t.analyzeCommentResponse),console.log(t.analyzeCommentResponse),t.checkInProgress=!1,t.canAcceptFeedback=!0},function(e){console.error("Error",e),t.checkInProgress=!1,t.canAcceptFeedback=!1,t.analyzeErrorMessage=t._getErrorMessage(e),t.analyzeCommentResponse=null})},e.prototype.getMaxScore=function(n){var i=this;if(null===n||null==n.attributeScores)return 0;var o=undefined;return Object.keys(n.attributeScores).forEach(function(e){var t=i.getMaxSpanScore(n.attributeScores[e]);(o===undefined||o<t)&&(o=t)}),o===undefined&&(console.error('No "value" field found for score. Returning 0.'),o=0),o},e.prototype.getMaxSpanScore=function(e){var t,n,i=undefined;try{for(var o=f(e.spanScores),a=o.next();!a.done;a=o.next()){var r=a.value;(i===undefined||r.score.value>i)&&(i=r.score.value)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(n=o["return"])&&n.call(o)}finally{if(t)throw t.error}}return i},e}();P.decorators=[{type:n.Component,args:[{selector:"convai-checker",template:'<div id="checkerContainer">\n  \x3c!-- TODO(rachelrosen): merge perspective-status and convai-checker\n       and move a large portion of the convai-checker code to the perspective-api service. --\x3e\n  <perspective-status\n    [fontSize]="fontSize"\n    [indicatorWidth]="13"\n    [indicatorHeight]="13"\n    [gradientColors]="demoSettings.gradientColors"\n    [scoreThresholds]="demoSettings.scoreThresholds"\n    [feedbackText]="demoSettings.feedbackText"\n    [configurationInput]="demoSettings.configuration"\n    [showPercentage]="demoSettings.showPercentage"\n    [showMoreInfoLink]="demoSettings.showMoreInfoLink"\n    [hasScore]="analyzeCommentResponse !== null"\n    [canAcceptFeedback]="canAcceptFeedback"\n    [feedbackRequestInProgress]="feedbackRequestInProgress"\n    [initializeErrorMessage]="initializeErrorMessage"\n    [analyzeErrorMessage]="analyzeErrorMessage"\n    [userFeedbackPromptText]="demoSettings.userFeedbackPromptText"\n    [hideLoadingIconAfterLoad]="demoSettings.hideLoadingIconAfterLoad"\n    [hideLoadingIconForScoresBelowMinThreshold]="demoSettings.hideLoadingIconForScoresBelowMinThreshold"\n    [alwaysHideLoadingIcon]="demoSettings.alwaysHideLoadingIcon"\n    [loadingIconStyle]="demoSettings.loadingIconStyle"\n    (commentFeedbackSubmitted)="onCommentFeedbackReceived($event)"\n    (scoreChangeAnimationCompleted)="handleScoreChangeAnimationCompleted()"\n    (modelInfoLinkClicked)="handleModelInfoLinkClicked()">\n  </perspective-status>\n</div>\n',styles:["#checkerContainer{font-family:Roboto,sans-serif;line-height:1}"],providers:[R],host:{"(document:input)":"_handleInputEvent($event)"}}]}],P.ctorParameters=function(){return[{type:n.ElementRef},{type:R}]},P.propDecorators={statusWidget:[{type:n.ViewChild,args:[w]}],inputId:[{type:n.Input}],serverUrl:[{type:n.Input}],fontSize:[{type:n.Input}],demoSettings:[{type:n.Input}],demoSettingsJson:[{type:n.Input}],pluginEndpointUrl:[{type:n.Input}],scoreChangeAnimationCompleted:[{type:n.Output}],scoreChanged:[{type:n.Output}],modelInfoLinkClicked:[{type:n.Output}],analyzeCommentResponseChanged:[{type:n.Output}]};var D=500,j="sessionId",q=function W(){};q.decorators=[{type:n.NgModule,args:[{declarations:[P,w],exports:[P,w],imports:[a.BrowserAnimationsModule,r.BrowserModule,u.FormsModule,l.HttpModule,h.MatButtonModule,m.MatFormFieldModule,h.MatInputModule,p.MatSelectModule],providers:[R,{provide:d.APP_BASE_HREF,useValue:"/"}],bootstrap:[P]}]}],e.ConvaiCheckerModule=q,e.DEFAULT_DEMO_SETTINGS=F,e.ConvaiChecker=P,e.Shape=y,e.Emoji=S,e.Configuration=b,e.ConfigurationInput=C,e.ScoreThreshold=A,e.LoadingIconStyle=E,e.DEFAULT_FEEDBACK_TEXT=I,e.PerspectiveStatus=w,e.ɵa=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=conversationai-perspectiveapi-authorship-demo.umd.min.js.map
